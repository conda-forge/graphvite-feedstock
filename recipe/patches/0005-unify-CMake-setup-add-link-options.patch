From b305b4e0afa51efe3bb93d839188db4f1453eec6 Mon Sep 17 00:00:00 2001
From: "H. Vetinari" <h.vetinari@gmx.com>
Date: Mon, 14 Feb 2022 16:58:19 +1100
Subject: [PATCH 5/6] unify CMake setup; add link-options

---
 src/CMakeLists.txt | 19 +++++++++----------
 1 file changed, 9 insertions(+), 10 deletions(-)

diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 55aaebb..65d7030 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -1,14 +1,13 @@
-if (WIN32)
-    add_library(graphvite graphvite.cu)
-else ()
-    add_library(graphvite SHARED graphvite.cu)
-    set_target_properties(graphvite PROPERTIES
-            CXX_VISIBILITY_PRESET   "hidden"
-            CUDA_VISIBILITY_PRESET  "hidden"
-            LINK_FLAGS              "-flto -Wl,-rpath=$ORIGIN"
-            OUTPUT_NAME             graphvite)
+add_library(graphvite SHARED graphvite.cu)
+set_target_properties(graphvite PROPERTIES
+                      CXX_VISIBILITY_PRESET   "hidden"
+                      CUDA_VISIBILITY_PRESET  "hidden"
+                      OUTPUT_NAME             graphvite)
 
-    target_link_libraries(graphvite pthread curand glog faiss)
+target_link_libraries(graphvite pthread curand glog faiss)
+
+if (NOT MSVC)
+    target_link_options(graphvite PUBLIC "LINKER:-flto,-rpath=$ORIGIN")
     target_compile_options(graphvite PRIVATE "-Xcompiler=-fno-fat-lto-objects") # -flto
 endif ()
 
-- 
2.32.0.windows.2

